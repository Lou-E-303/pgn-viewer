import { Chessground } from 'chessground';
import { h } from 'snabbdom';
import { bind, bindMobileMousedown, bindNonPassive, eventRepeater, onInsert, stepwiseScroll } from './util';
export default function view(ctrl) {
    return ctrl.menu ? renderMenu(ctrl) : renderReplay(ctrl);
}
const renderMenu = (ctrl) => h('div.lpv.lpv--menu', [
    h('div.lpv__menu__inner', [
        h('button.lpv__menu__entry.lpv__menu__flip.lpv__fbt', {
            hook: bind('click', ctrl.flip),
        }, ctrl.translate('flipTheBoard')),
        h('a.lpv__menu__entry.lpv__menu__analysis.lpv__fbt', {
            attrs: {
                href: ctrl.analysisUrl(),
                target: '_blank',
            },
        }, ctrl.translate('analysisBoard')),
        h('a.lpv__menu__entry.lpv__menu__practice.lpv__fbt', {
            attrs: {
                href: ctrl.practiceUrl(),
                target: '_blank',
            },
        }, ctrl.translate('practiceWithComputer')),
    ]),
    renderControls(ctrl),
]);
const renderControls = (ctrl) => h('div.lpv__controls', [
    dirButton('backward', ctrl, -1),
    h('button.lpv__fbt.lpv__controls__menu', {
        class: { active: ctrl.menu },
        hook: bind('click', ctrl.toggleMenu),
    }, 'â‹®'),
    dirButton('forward', ctrl, 1),
]);
const dirButton = (name, ctrl, dir) => h(`button.lpv__controls__${name}.lpv__fbt`, {
    class: { disabled: !ctrl.menu && (ctrl.index + dir < 0 || ctrl.index + dir >= ctrl.nodes.length) },
    hook: onInsert(el => bindMobileMousedown(el, e => eventRepeater(() => ctrl.onward(dir), e))),
});
const renderReplay = (ctrl) => h('div.lpv.lpv--replay', [
    renderBoard(ctrl),
    renderControls(ctrl),
    ctrl.opts.showMoves ? renderMoves(ctrl) : undefined,
]);
const renderMoves = (ctrl) => h('div.lpv__moves', 'moves');
const renderBoard = (ctrl) => h('div.lpv__board', {
    hook: wheelScroll(ctrl),
}, h('div.cg-wrap', {
    hook: {
        insert: vnode => (ctrl.ground = Chessground(vnode.elm, makeConfig(ctrl))),
    },
}));
const wheelScroll = (ctrl) => 'ontouchstart' in window || !ctrl.opts.scrollToMove
    ? undefined
    : bindNonPassive('wheel', stepwiseScroll((e, scroll) => {
        e.preventDefault();
        if (e.deltaY > 0 && scroll)
            ctrl.onward(1);
        else if (e.deltaY < 0 && scroll)
            ctrl.onward(-1);
    }));
export const makeConfig = (ctrl) => ({
    viewOnly: true,
    addDimensionsCssVars: true,
    drawable: {
        enabled: false,
        visible: false,
    },
    ...ctrl.cgConfig(),
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy92aWV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFMUMsT0FBTyxFQUFFLENBQUMsRUFBUyxNQUFNLFVBQVUsQ0FBQztBQUNwQyxPQUFPLEVBQUUsSUFBSSxFQUFFLG1CQUFtQixFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUU1RyxNQUFNLENBQUMsT0FBTyxVQUFVLElBQUksQ0FBQyxJQUFVO0lBQ3JDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDM0QsQ0FBQztBQUVELE1BQU0sVUFBVSxHQUFHLENBQUMsSUFBVSxFQUFFLEVBQUUsQ0FDaEMsQ0FBQyxDQUFDLG1CQUFtQixFQUFFO0lBQ3JCLENBQUMsQ0FBQyxzQkFBc0IsRUFBRTtRQUN4QixDQUFDLENBQ0Msa0RBQWtELEVBQ2xEO1lBQ0UsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQztTQUMvQixFQUNELElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQy9CO1FBQ0QsQ0FBQyxDQUNDLGlEQUFpRCxFQUNqRDtZQUNFLEtBQUssRUFBRTtnQkFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRTtnQkFDeEIsTUFBTSxFQUFFLFFBQVE7YUFDakI7U0FDRixFQUNELElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQ2hDO1FBQ0QsQ0FBQyxDQUNDLGlEQUFpRCxFQUNqRDtZQUNFLEtBQUssRUFBRTtnQkFDTCxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRTtnQkFDeEIsTUFBTSxFQUFF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